<%= content_for(:title, "Evercam: Add Camera") %>
<div id="add-ip"/>
<div class="page-content-wrapper">
  <div class="page-content">
    <div class="row">
      <div class="section-header">
        <div class="camera-title">
          Add a Camera
        </div>
      </div>
    </div>
    <div class="tabbable tabbable-custom">
      <div class="center-tabs">
        <ul class="nav nav-tabs">
          <li class="active">
            <a href="#tab_1_1" data-toggle="tab">
              Add IP Camera </a>
          </li>
          <li>
            <a href="#tab_1_2" data-toggle="tab">
              Add Android Camera
            </a>
          </li>
        </ul>
      </div>

      <div class="tab-content">
        <div class="tab-pane active" id="tab_1_1">
          <%= form_tag(cameras_new_path, method: 'post', class: 'form-horizontal has-validation-callback', autocomplete: 'off', role: 'form') do %>
            <% field_errors = (flash[:field_errors] || {}) %>
            <div class="col-md-12">
                <!-- A workaround for chrome autofill entering camera user & pass autocomplete="off" no longer obeyed -->
                <input style="display:none" type="text" name="fakeusernameremembered"/>
                <input style="display:none" type="password" name="fakepasswordremembered"/>

                <div class="col-md-11">
                  <div class="row">
                    <div class='col-md-12'>
                      <div class='<%= field_errors["name"] ? ' has-error' : '' %>'>
                        <%= label_tag('camera-name', "Friendly Name*", class: "col-md-2 control-label") %>
                        <div class="col-md-3">
                          <%= text_field_tag("camera-name", @user['camera-name'], "placeholder" => "Rooftop Camera", "class" => "form-control", "data-validation-help" => "To identify your camera in the dashboard.", "data-validation" => "alphanumeric length", "data-validation-length" => "max24", "data-validation-allowing" => "-_ ", "data-validation-error-msg" => "Max 24 characters containing letters, spaces and hyphens.") %>
                          <% if field_errors["name"] %>
                            <span class="help-block form-error text-left"><%= field_errors["name"] %></span>
                          <% end %>
                        </div>
                      </div>
                      <div class='model<%= field_errors["id"] ? ' has-error' : '' %>'>
                        <%= label_tag('camera-id', "Evercam ID*", class: "col-md-2 control-label") %>
                        <div class="col-md-3">
                          <%= text_field_tag("camera-id", @user['camera-id'], "placeholder" => "roof-cam", "class" => "form-control", "data-validation-help" => "This must be unique and cannot be changed.", "data-validation" => "alphanumeric length custom", "data-validation-regexp" => "^[a-z0-9._/-]{2,100}$", "data-validation-length" => "min4", "data-validation-allowing" => "-_", "data-validation-error-msg" => "Min 4 characters. Only lowercase letters, numbers &amp; hyphens and underscores. No spaces.") %>
                          <% if field_errors["id"] %>
                            <div class="help-block form-error text-left"><%= field_errors["id"] %></div>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class='row margin-top-40'>
                    <div class='col-md-12'>
                      <div class='<%= field_errors["vendor"] ? ' has-error' : '' %>'>
                        <%= label_tag('camera-vendor', "Camera Vendor", class: "col-md-2 control-label") %>
                        <div class="col-md-3">
                          <select id="camera-vendor" name="camera-vendor" class="form-control">
                            <option value="">-- Select Make --</option>
                          </select>
                          <input type="hidden" id="last-selected-vendor" value="<%= @user['camera-vendor'] %>">
                          <% if field_errors["vendor"] %>
                            <span class="help-block form-error text-left"><%= field_errors["vendor"] %></span>
                          <% end %>
                        </div>
                      </div>

                      <div class='<%= field_errors["model"] ? ' has-error' : '' %>'>
                        <%= label_tag('camera-model', "Camera Model", class: "col-md-2 control-label") %>
                        <div id="reveal" class="col-md-3">
                          <p class="help-block this form-error text-left" style="display: none;">Leave this as
                            'Default' if you're unsure</p>
                          <select id="camera-model" name="camera-model" class="form-control camera-model">
                            <option value="">-- Select Model --</option>
                          </select>
                          <input type="hidden" id="last-selected-model" value="<%= @user['camera-model'] %>">
                          <% if field_errors["model"] %>
                            <span class="help-block form-error text-left"><%= field_errors["model"] %></span>
                          <% end %>

                        </div>
                      </div>
                    </div>
                  </div>

                  <div class='row margin-top-30'>
                    <div class='col-md-12'>
                      <label for="" class="col-md-2 control-label margin-top-30">Snapshot URL</label>

                      <div id="unreveal" class="col-md-3">
                        <div id="ext-ip" class='<%= field_errors["external_host"] ? ' has-error' : '' %>'>
                          <%= label_tag('camera-url', raw("External <strong>IP</strong> (or URL)*"), class: "grey control-label") %>
                          <div class="input-group">
                            <span class="input-group-addon">http://</span>
                            <%= text_field_tag("camera-url", @user['camera-url'], "placeholder" => "149.5.43.10", "class" => "form-control", "data-validation-help" => "Just include the domain. Not http:// or anything anything from the first /", "data-validation" => "custom", "data-validation-regexp" => "^[a-zA-Z0-9._/-]{2,100}$", "data-validation-error-msg" => "This should be in the form of <strong>149.5.43.10</strong> or <strong>portlarochelle.com</strong>") %>
                          </div>
                          <div id="box" class="box">
                            <% if field_errors["external_host"] %>
                              <span class="help-block form-error text-left"><%= field_errors["external_host"] %></span>
                            <% end %>
                          </div>
                        </div>
                      </div>

                      <div class='col-md-2<%= field_errors["external_http_port"] ? ' has-error' : '' %>'>
                        <%= label_tag('port', raw("HTTP Port*"), class: "grey control-label") %>
                        <div id="camera-port" class="input-group">
                          <span class="prepend prepend-1">:</span>
                          <%= text_field_tag("port", @user['port'] || 80, "placeholder" => "8001", "class" => "form-control", "data-validation" => "custom", "data-validation-regexp" => "^[0-9]{2,5}$", "data-validation-error-msg" => "The Port should be a 2-5 digit number.") %>
                          <% if field_errors["external_http_port"] %>
                            <span class="help-block form-error text-left"><%= field_errors["external_http_port"] %></span>
                          <% end %>
                        </div>
                      </div>

                      <div class='col-md-3<%= field_errors["jpg_url"] ? ' has-error' : '' %>'>
                        <%= label_tag('snapshot', "Snapshot URL Ending*", class: "grey control-label") %>
                        <div class="snap-end">
                          <span class="prepend prepend-2">/</span>
                          <%= text_field_tag("snapshot", @user['snapshot'], "placeholder" => "snapshot.jpg", "class" => "form-control", "data-validation-help" => "Include the entire snapshot path after the domain eg.data-externe/webcam/webcam.jpg", "data-validation" => "alphanumeric", "data-validation-allowing" => "-_/.?=", "data-validation-error-msg" => "") %>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row margin-top-40">
                    <div class='col-md-12'>
                      <div class='<%= field_errors["username"] ? ' has-error' : '' %>'>
                        <%= label_tag('camera-username', "Camera Username", class: "col-md-2 control-label") %>
                        <div class="col-md-3">
                          <%= text_field_tag("camera-username", @user['camera-username'], "data-validation-help" => "Enter the Username of the camera.", "class" => "form-control") %>
                          <% if field_errors["username"] %>
                            <span class="help-block form-error text-left"><%= field_errors["username"] %></span>
                          <% end %>
                        </div>
                      </div>
                      <div class='<%= field_errors["password"] ? ' has-error' : '' %>'>
                        <%= label_tag('camera-password', "Camera Password", class: "col-md-2 control-label") %>
                        <div class="col-md-3">
                          <%= password_field_tag("camera-password", @user['camera-password'], "data-validation-help" => "Enter the Password of the camera.", class: "form-control") %>
                          <% if field_errors["password"] %>
                            <span class="help-block form-error text-left"><%= field_errors["password"] %></span>
                          <% end %>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row margin-top-30">
                    <div class='col-md-12'>
                      <div class="btn additional expand">Additional Settings <i class="fa fa-caret-down"></i></div>
                      <div class="settings">
                        <div class="row margin-top-20">
                          <div class="col-md-12">
                            <label for="" class="col-md-2 control-label">Local IP</label>

                            <div class="col-md-3">
                              <div class='<%= field_errors["internal_host"] ? ' has-error' : '' %>'>
                                <%= label_tag('local-ip', "Local IP", class: "col-md-2 control-label hide") %>
                                <div class="input-group">
                                  <span class="input-group-addon">http://</span>
                                  <%= text_field_tag("local-ip", @user['local-ip'], "class" => "form-control", "data-validation" => "custom", "data-validation-regexp" => "^[a-zA-Z0-9._/-]{2,100}$", "data-validation-error-msg" => "This doesn't appear to be a valid IP or URL.", "data-validation-optional" => "true") %>
                                  <% if field_errors["internal_host"] %>
                                    <span class="help-block form-error text-left"><%= field_errors["internal_host"] %></span>
                                  <% end %>
                                </div>
                              </div>
                            </div>

                            <div class='<%= field_errors["internal_http_port"] ? ' has-error' : '' %>'>
                              <%= label_tag('local-http', "Local HTTP Port", class: "col-md-2 control-label") %>
                              <div class="col-md-3">
                                <%= text_field_tag("local-http", @user['local-http'], "class" => "form-control", "data-validation" => "custom", "data-validation-regexp" => "^[0-9]{2,5}$", "data-validation-error-msg" => "The Port should be a 2-5 digit number.", "data-validation-optional" => "true") %>
                                <% if field_errors["internal_http_port"] %>
                                  <span class="help-block form-error text-left"><%= field_errors["internal_http_port"] %></span>
                                <% end %>
                              </div>
                            </div>
                          </div>
                        </div>


                        <div id="port" class="row margin-top-20">
                          <div class="col-md-12">
                            <div class='<%= field_errors["external_rtsp_port"] ? ' has-error' : '' %>'>
                              <%= label_tag('ext-rtsp-port', raw("External RTSP Port"), class: "col-md-2 control-label") %>
                              <div class="col-md-3">
                                <%= text_field_tag("ext-rtsp-port", @user['ext-rtsp-port'], "class" => "form-control", "data-validation" => "custom", "data-validation-regexp" => "^[0-9]{2,5}$", "data-validation-help" => "The port should be a 2-5 digit number", "data-validation-error-msg" => "The Port should be a #, 2-5 digits.", "data-validation-optional" => "true") %>
                                <% if field_errors["external_rtsp_port"] %>
                                  <span class="help-block form-error text-left"><%= field_errors["external_rtsp_port"] %></span>
                                <% end %>
                              </div>
                            </div>
                            <div class='<%= field_errors["internal_rtsp_port"] ? ' has-error' : '' %>'>
                              <%= label_tag('local-rtsp', "Local RTSP Port", class: "col-md-2 control-label") %>
                              <div class="col-md-3">
                                <%= text_field_tag("local-rtsp", @user['local-rtsp'], "class" => "form-control", "data-validation" => "custom", "data-validation-regexp" => "^[0-9]{2,5}$", "data-validation-error-msg" => "The Port should be a 2-5 digit number.", "data-validation-optional" => "true") %>
                                <% if field_errors["internal_rtsp_port"] %>
                                  <span class="help-block form-error text-left"><%= field_errors["internal_rtsp_port"] %></span>
                                <% end %>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-1">
                  <div class="media" id="add-test">
                    <div class="test-img-holder">
                      <img id="testimg" src="" class="text-center testimg-add" width="100%"></div>
                    <div class="test-snapshot">
                      <section class="progress-demo">
                        <a href="#" id="test" class="btn btn-primary ladda-button" role="button" data-style="expand-left"><span class="ladda-label">Test Snapshot</span></a>
                      </section>
                      <div id="test-error"><span></span></div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class='form-actions col-md-12'>
                    <div class='form-actions col-md-6 col-md-offset-2 margin-top-20'>
                      <div class="form-group">
                        <label class="control-label" for="add-button"></label>
                        <section class="progress-demo">
                          <button id="add-button" name="add-button" class="btn btn-primary ladda-button" role="button" data-size="xl" data-style="expand-left">
                            Finish &amp; Add
                          </button>
                        </section>
                      </div>
                    </div>
                  </div>
                </div>
          <% end %>

          </div>
        </div>

        <div class="tab-pane" id="tab_1_2">
          <div class="col-lg-12 margin-bottom-20">
            <p>
              Easily add your Android cameras to the Evercam Dashoard with our Evercam Play App.
            </p>

            <a href="https://play.google.com/store/apps/details?id=io.evercam.capture" target="_blank">
              <img alt="Android app on Google Play" src="//developer.android.com/images/brand/en_app_rgb_wo_60.png" width="110px" margin-top="20px"/>
            </a>
          </div>
        </div>
        <div class="tab-pane" id="tab_1_3"></div>

      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function () {
    window.initializeAddCamera();
  });
</script>

<%= javascript_include_tag "cameras/single/testsnapshot" %>
