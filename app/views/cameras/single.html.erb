<%= content_for(:title, "Evercam: Camera View") %>

<div class="page-content-wrapper">
  <div class="page-content" id="camera-single">
    <div class="row">
      <div class="section-header">
        <div class="camera-title">
          <div class="col-xs-12 col-md-12">
            <div class="btn-group camera-switch">
              <h3 class="page-title"><%= @camera['name'] %></h3>
            </div>
            <div class="pull-right camera-status">
              <% if @camera['is_online'] %>
                <div class="green">Online</div>
              <% else %>
                <div class="red">Offline</div>
              <% end %>
            </div>
            <% unless @camera['owner'] == current_user.username %>
              <div class="pull-right margin-right-10">
                <i class="icon icon-users"></i>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="portlet-body">
      <% has_edit_right = @camera["rights"].split(",").include?("edit") %>
      <div class="tabbable tabbable-custom">
        <div class="center-tabs">
          <ul class="nav nav-tabs">
            <li class="active">
              <a id="nav-tabs-2" data-toggle="tab" data-target="#details" class="nav-tab-details nav-tab-">Details</a>
            </li>

            <li>
              <a data-toggle="tab" data-target="#live" class="nav-tab-live">Live View</a>
            </li>

            <li>
              <a data-toggle="tab" data-target="#recordings" class="nav-tab-recordings">Snapshots</a>
            </li>

            <% if has_edit_right %>
              <li>
                <a data-toggle="tab" data-target="#shares" class="nav-tab-shares">Sharing</a>
              </li>
            <% end %>

            <li>
              <a data-toggle="tab" data-target="#api-explorer" class="nav-tab-api-explorer">API Explorer</a>
            </li>

            <% if has_edit_right %>
              <li>
                <a data-toggle="tab" data-target="#logs" class="nav-tab-logs">Logs</a>
              </li>
            <% end %>

            <li>
              <a data-toggle="tab" data-target="#apps" class="nav-tab-apps">Apps</a>
            </li>

            <li>
              <a data-toggle="tab" data-target="#webhooks" class="nav-tab-webhooks">Webhooks</a>
            </li>

            <% if @camera['vendor_name'] == 'Hikvision Digital Technology' %>
              <li>
                <a data-toggle="tab" data-target="#local-storage" class="nav-tab-local-storage">Local Storage</a>
              </li>
            <% end %>
            <li>
              <a data-toggle="tab" data-target="#settings" class="nav-tab-settings">Settings</a>
            </li>
          </ul>
        </div>

        <div class="tab-content">
          <div id="details" class="tab-pane active">
            <%= render partial: "cameras/single/info_tab" %>
          </div>

          <div id="live" class="tab-pane">
            <%= render partial: "cameras/single/live_view_tab" %>
          </div>

          <div id="recordings" class="tab-pane">
            <%= render partial: "cameras/single/snapshots_navigator_tab" %>
          </div>

          <% if has_edit_right %>
            <div id="shares" class="tab-pane">
              <%= render partial: "cameras/single/sharing_tab" %>
            </div>
          <% end %>

          <div id="api-explorer" class="tab-pane">
            <%= render partial: "cameras/single/api_explorer_tab" %>
          </div>

          <% if has_edit_right %>
            <div id="logs" class="tab-pane">
              <%= render partial: "cameras/single/logs_tab" %>
            </div>
          <% end %>

          <div id="apps" class="tab-pane">
            <%= render partial: "cameras/single/apps_tab" %>
          </div>

          <div id="webhooks" class="tab-pane">
            <%= render partial: "cameras/single/webhooks_tab" %>
          </div>

          <% if @camera['vendor_name'] == 'Hikvision Digital Technology' %>
            <div id="local-storage" class="tab-pane">
              <%= render partial: "cameras/single/local_storage_tab" %>
            </div>
          <% end %>

          <div id="settings" class="tab-pane">
            <%= render partial: "cameras/single/settings_tab" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  window.Evercam.Camera = {
    id: '<%= @camera['id'] %>',
    is_online: <%= @camera['is_online'] %>,
    vendor_id: '<%= @camera['vendor_id'] %>',
    model_name: '<%= @camera['model_name'] %>',
    location: {
      lat: <%= @camera.deep_fetch('location', 'lat') {} %>,
      lng: <%= @camera.deep_fetch('location', 'lng') {} %>
    }
  };
  <% params_subpath = params.fetch('subpath', '') %>
  window.Evercam.request = {
    url: '<%= request.url %>',
    path: '<%= request.path %>',
    subpath: '<%= params_subpath %>',
    tabpath: '<%= params_subpath.split('/').first %>',
    rootpath: '<%= request.path.sub(params_subpath, '').chomp('/') %>'
  };

  $(document).ready(function () {
    window.initializeCameraSingle();
  });
</script>
