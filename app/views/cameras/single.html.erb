<%= javascript_include_tag "camera_single" %>
<div class="bb-alert alert alert-info" style="display:none;">
  <span></span>
</div>

  <%= render :partial => "sidebar/sidebar" %>
<div id="camera-single">
<section id="main-content">
  <section class="wrapper site-min-height">
<div class="col-md-12">
    <div class="row">
        <div class="camera-title">
          <div class="col-md-8 col-sm-12">
            <h4><%= @camera['name'] %><small>   &#123;<%= @camera['id'] %>&#125;</small></h4>
          </div>
          <div id="status" class="col-md-4">
            <% if @camera['is_online'] %>
              <h5 class="green pull-right">Online</h5>
            <% else %>
              <h5 class="red pull-right">Offline</h5>
            <% end %>
          </div>
        </div>
    </div>
</div>
  <section class="panel">
    <% has_edit_right = @camera["rights"].split(",").include?("edit") %>
    <header class="panel-heading">
      <ul class="nav nav-tabs">
        <li class="active">
          <a data-toggle="tab" href="#live">Live View</a>
        </li>
        <li>
          <a data-toggle="tab" href="#info">Info</a>
        </li>
        <% if has_edit_right %>
          <li>
            <a data-toggle="tab" href="#sharing">Sharing</a>
          </li>
        <% end %>
        <!--<li class="">
              <a data-toggle="tab" href="#following">Following</a>
            </li>-->
        <li>
          <a data-toggle="tab" href="#explorer">API Explorer</a>
        </li>
        <% if has_edit_right %>
          <li>
            <a data-toggle="tab" href="#logs">Logs</a>
          </li>
        <% end %>
        <li class="disabled">
          <a data-toggle="tab" href="#apps">Apps</a>
        </li>
        <% if has_edit_right %>
          <li class="pull-right">
            <a data-toggle="tab" href="#camera-settings" id="camera-settings-link"><span class="glyphicon glyphicon-cog"></span></a>
          </li>
        <% else %>
          <li class="pull-right">
            <a id="remove-camera-button" data-toggle="modal" data-target="#deleteModal" class="" href=""><span class="glyphicon glyphicon-trash"></span></a>
          </li>
        <% end %>
      </ul>
    </header>



    <div class="tab-content panel-body">
      <!--LIVE VIEW TAB PANE -->
      <div id="live" class="tab-pane active">
        <%= render partial: "live/live_tab" %>

      </div>

      <!--INFO TAB PANE -->
      <div id="info" class="tab-pane">
        <%= render partial: "info/info_tab" %>
      </div>

      <!--SHARING TAB PANE -->
      <div id="sharing" class="tab-pane">
        <%= render partial: "sharing/sharing_tab" %>
      </div>

      <!--FOLLOWING TAB PANE -->
      <!--<div id="following" class="tab-pane">

      </div>-->

      <!--EXPLORER TAB PANE -->
      <div id="explorer" class="tab-pane">
        <%= render partial: "explorer/explorer_tab" %>
      </div><!--TAB PANE -->

      <!--LOGS TAB PANE -->
      <div id="logs" class="tab-pane">
        <%= render partial: "logs/logs_tab" %>
      </div><!--TAB PANE -->

      <!--APPS TAB PANE -->
      <div id="apps" class="tab-pane">
        <div class='panel-body'>
          <div class="col-lg-12">
            <a href="http://www.evercam.io/apps" target="_blank">View Apps To Add To Your Camera</a>
          </div>
        </div><!--panel-body -->
      </div><!--TAB PANE -->

      <!--SETTINGS TAB PANE -->
      <div id="camera-settings" class="tab-pane">
        <%= render partial: "settings/settings_tab" %>
      </div><!--TAB PANE -->

    </div><!--panel body-->

  </section><!--panel-->












  <!--DELETE MODAL-->
  <% if !has_edit_right %>
  <div id="deleteModal" class="modal fade">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
            <p class="text-left">Are You Sure You Want to <strong>Remove</strong> this Camera?</p>
        </div>
        <div class="modal-footer">
          <div class="col-sm-8">
              <a href="<%= url_for(action: 'delete', id: @camera['id'], share_id: @share['id'], share: true) %>" class="btn btn-danger pull-left" rel="nofollow" role="button" data-method="delete">
                <span class="glyphicon glyphicon-remove"></span>  Remove</a>
            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  <% end %>
  <!--END DELETE MODAL-->



</section>
</section>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.1.47/jquery.form-validator.min.js"></script>
<script>

  $(function () {
    var previous;
    $('#camera-vendor').one('focus', function () {
      previous = this.value;
    }).on('change', function () {
      $('#camera-model' + previous).addClass('hidden');
      $('#camera-model' + this.value).removeClass('hidden');
      previous = this.value;
    });

    $('#test').click(function (e) {
      var params = ['external_url=http://' + $('#camera-url').val() + ':' + $('#port').val(), 'jpg_url=' + $('#snapshot').val().replace(/\?/g, 'X_QQ_X').replace(/&/g, 'X_AA_X'),
          'cam_username=' + $('#camera-username').val(), 'cam_password=' + $('#camera-password').val()];
      e.preventDefault();
      var l = Ladda.create(this);
      l.start();
      var progress = 0;
      var interval = setInterval(function () {
        progress = Math.min(progress + 0.025, 1);
        l.setProgress(progress);

        if (progress === 1) {
          l.stop();
          clearInterval(interval);
        }
      }, 200);
      $.getJSON('<%= EVERCAM_API %>cameras/test.json?' + params.join('&'))
        .done(function (resp) {
          console.log('success');
          $('#testimg').attr('src', resp.data);

        })
        .fail(function (resp) {
          $('#test-error').text(resp.responseJSON.message);
          console.log('error');
        })
        .always(function () {
          l.stop();
          clearInterval(interval);
        });
    });


    // Javascript to enable link to tab
    var url = document.location.toString();
    if (url.match('#')) {
      $('.nav-tabs a[href=#' + url.split('#')[1] + ']').tab('show');
      setTimeout(function () {
        scrollTo(0, 0)
      }, 10);
    }

    // Change hash for page-reload
    $('.nav-tabs a').on('shown.bs.tab', function (e) {
      window.location.hash = e.target.hash;
      scrollTo(0, 0);
    })

  });
</script>

