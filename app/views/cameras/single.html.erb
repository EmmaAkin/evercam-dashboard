<div class="boxed-page">
<div class="container clearfix">
<section id="camera-single">

<!--sidebar start-->
<div id="sidebar" class="nav-collapse col-md-2 col-xs-12">
  <ul class="sidebar-menu" id="nav-accordion">
    <li class="sub-menu">
      <a href="/" class="active">
        <span>My Cameras</span>
      </a>
    </li>
    <li>
      <ul class="sub active">
        <li>
          <!--<%# @cameras.each do |camera| %>
                <a href="/cameras/<%#= camera['id'] %>"><%#= camera['name'] %></a>
                <%# end %>-->
        </li>
      </ul>
    </li>
    <li>
      <a href="/cameras/new"><span class="glyphicon glyphicon-plus"></span>Add A Camera</a>
    </li>
  </ul>
</div>
<!--sidebar end-->


<section class="wrapper site-min-height col-md-10">
<div class="row">
  <div class="col-md-12"><h4><%= @camera['name'] %>    <small>   <%= @camera['id'] %></small></h4></div>
</div>

<div class="row">


<div class="col-md-12">
<!--tab nav start-->

<header class="panel-heading tab-bg-dark-navy-blue ">
  <ul class="nav nav-tabs">
    <li class="active">
      <a data-toggle="tab" href="#live">Live View</a>
    </li>
    <li class="">
      <a data-toggle="tab" href="#info">Camera Info</a>
    </li>
    <li class="">
      <a data-toggle="tab" href="#camera-settings">Settings</a>
    </li>
    <li class="">
      <a data-toggle="tab" href="#sharing">Sharing</a>
    </li>
    <li class="">
      <a data-toggle="tab" href="#apps">Apps</a>
    </li>
    <li class="">
      <a data-toggle="tab" href="#activity">Activity</a>
    </li>
    <li class="">
      <a data-toggle="tab" href="#logs">Logs</a>
    </li>
    <li class="">
      <a data-toggle="tab" href="#explorer">API Explorer</a>
    </li>
    <li class="pull-right">
      <a data-toggle="tab" href="#delete"><span class="glyphicon glyphicon-remove"></span>  Delete</a>
    </li>

  </ul>
</header>

<!--LIVE VIEW TAB PANE -->
<div class="tab-content">
<div id="live" class="tab-pane active">
  <div class="col-md-8">
    <div class="panel media">
      <img src="<%= @camera['jpg'] %>" width="100%" height="auto">
    </div>
  </div>
  <% if @camera['is_online'] %>
      <div class="col-md-4 panel panel-body online">
        <span class="glyphicon glyphicon-ok circle-sign"></span>Online
      </div>
  <% else %>
      <div class="col-md-4 panel panel-body offline">
        <span class="glyphicon glyphicon-info-sign"></span>Offline
      </div>
  <% end %>
  <a href="#" class="btn btn-primary refresh" role="button"><span class="glyphicon glyphicon-refresh"></span>Refresh Snapshot</a>
</div>

<!--INFO TAB PANE -->
<div id="info" class="tab-pane">
  <div class="col-md-4 panel panel-body">
    <table class='table borderless'>
      <thead>
      <tr><h5>Info</h5></tr>
      </thead>
      <tr>
        <td>Camera ID   </td>
        <td><%= @camera['id'] %></td>
      </tr>
      <tr>
        <td>Camera Owner   </td>
        <td><%= @camera['owner'] %></td>
      </tr>
      <tr>
        <td>Local IP   </td>
        <td><%= @camera.fetch('config', {}).fetch('internal_host', '') %></td>
      </tr>
    </table>
  </div>
  <div class="col-md-6 panel panel-body">
    <table class='table borderless'>
      <thead>
      <tr><h5>Assets</h5></tr>
      </thead>
      <tr>
        <td >JPEG URL   </td>
        <td>JPEG URL: http://evr.cm/rem-cam.jpg</td>
      </tr>
      <tr>
        <td>H264 URL   </td>
        <td>H264 URL: http://evr.cm/rem-cam.h264</td>
      </tr>
      <tr>
        <td>Audio URL  </td>
        <td>http://evr.cm/rem-cam.aac</td>
      </tr>
    </table>
  </div>
  <div class="col-md-6 panel panel-body">
    <table class='table borderless'>
      <thead>
      <tr><h5>Stream</h5></tr>
      </thead>
      <tr>
        <td >HTTP MPEG4 Stream</td>
        <td>http://192.168.1.198:8001/stream.av</td>
      </tr>
      <tr>
        <td>HTTP MJPEG Stream</td>
        <td>http://192.168.1.198:8001/stream.jpg</td>
      </tr>
      <tr>
        <td>HTTP ASF Stream</td>
        <td>http://192.168.1.198:8001/stream.asf</td>
      </tr>
      <tr>
        <td>HTTP Snapshot Image</td>
        <td>http://192.168.1.198:8001/snapshot.jpg</td>
      </tr>
    </table>
  </div>
</div>


<!--INFO TAB PANE -->
<div id="camera-settings" class="tab-pane">
  <form action="#" method="post">
    <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>

    <!-- STEP 1 -->
    <fieldset>
      <div class='row add-row'>
        <div class='col-lg-10 col-lg-offset-1'>
          <div class='col-lg-6 form-group'>
            <label class="control-label" for="camera-name">Friendly Name</label>
            <!--<span data-toggle="tooltip" data-title="This is the friendly name you will give to your Camera to identify it in the Evercam Dashboard" class="label label-default">?</span>-->
            <input id="camera-name" name="camera-name" placeholder="Rooftop Camera" class="form-control" required="" type="text" data-validation="alphanumeric" data-validation-allowing="-_ " data-validation-error-msg="Can contain letters, numbers, spaces and hyphens." value="<%= @camera['name'] %>">
          </div>
          <div class='col-lg-6 form-group'>
            <label class="control-label" for="camera-id">Evercam ID</label>
            <span data-toggle="tooltip" data-title="This ID is unique to your Evercam Camera and cannot be changed" class="label label-default">?</span>
            <input id="camera-id" placeholder="roof-cam" class="form-control" disabled="disabled" required="" type="text" data-validation="alphanumeric" data-validation-allowing="-_" data-validation-error-msg="The ID needs to be unique and contain letters and '-'. No spaces." value="<%= @camera['id'] %>">
            <input type="hidden" name="camera-id" value="<%= @camera['id'] %>">
          </div>
        </div>
      </div>

    </fieldset>

    <!-- STEP 2 -->
    <fieldset>
      <div class='row add-row'>
        <div class='col-lg-10 col-lg-offset-1'>
          <div class='col-lg-6 form-group'>
            <label class="control-label" for="camera-username">Camera Username</label>
            <!--<span data-toggle="tooltip" data-title="The camera you are trying to connect will already have a Username that you will need to enter here. It will have been created by the camera owner" class="label label-default">?</span>-->
            <input id="camera-username" name="camera-username" placeholder="" class="form-control" type="text" value="<%= @camera['cam_username'] %>">
          </div>
          <div class='col-lg-6 form-group'>
            <label class="control-label" for="camera-password">Camera Password</label>
            <!--<span data-toggle="tooltip" data-title="The camera you are trying to connect will already have a Password that will have been created by the camera owner" class="label label-default">?</span>-->
            <input id="camera-password" name="camera-password" placeholder="" class="form-control" type="text" value="<%= @camera['cam_password'] %>">
          </div>
        </div>
      </div>
    </fieldset>

    <!-- STEP 3 -->
    <fieldset>
      <div class='row add-row-last'>
        <div class='col-lg-10 col-lg-offset-1'>
          <div class='col-lg-8'>
            <div class='row'>
              <div class='col-lg-10 form-group'>
                <label class="control-label" for="camera-url">External IP (or URL)</label>
                <!--<span data-toggle="tooltip" data-title="This will just contain the IP address in the form of 149.237.192.68 - http:// is already included" class="label label-default">?</span>-->
                <div class="input-group">
                  <span class="input-group-addon">http://</span>
                  <input id="camera-url" name="camera-url" placeholder="149.237.192.68" class="form-control" required="" type="text" data-validation="custom" data-validation-regexp="^[a-zA-Z0-9._/-]{2,100}$" data-validation-error-msg="This doesn't appear to be a valid IP." value="<%= @camera['external_host'] %>">
                </div>
              </div>
            </div>
            <div class='row'>
              <div class='col-lg-5 form-group'>
                <label class="control-label" for="port">External HTTP Port</label>
                <!--<span data-toggle="tooltip" data-title="The snapshot URL is the path to where the cameras snapshots are currently stored." class="label label-default">more info</span>-->
                <input id="port" name="port" placeholder="8901" class="form-control" required="" type="text" data-validation="custom" data-validation-regexp="^[0-9]{2,5}$"  data-validation-error-msg="The Port should be a 2-5 digit number." value="<%= @camera['external_http_port'] %>">
              </div>
              <div class='col-lg-5 form-group'>
                <label class="control-label" for="ext-rtsp-port">External RTSP Port</label>
                <!--<span data-toggle="tooltip" data-title="This Field is optional." class="label label-default">optional</span>-->
                <input id="ext-rtsp-port" name="ext-rtsp-port" placeholder="554" class="form-control" type="text" data-validation="custom" data-validation-regexp="^[0-9]{2,5}$"  data-validation-error-msg="The Port should be a 2-5 digit number." data-validation-optional="true" value="<%= params['ext-rtsp-port'] %>">
              </div>
            </div>
            <div class='row'>
              <div class='col-lg-10 form-group'>
                <label class="control-label" for="snapshot">Snapshot URL</label>
                <!--<span data-toggle="tooltip" data-title="The snapshot URL is the path to where the cameras snapshots are currently stored. It must begin with '/'" class="label label-default">?</span>-->
                <input type="text" id="snapshot" name="snapshot" placeholder="/snapshot.jpg" class="form-control" data-validation="custom" data-validation-regexp="^/[a-zA-Z0-9._/-]{2,100}$" data-validation-error-msg="This doesn't appear to be a valid URL" value="<%= @camera['jpg_url'] %>" >
              </div>
            </div>
            <div class="">
              <a href="#" class="close" data-dismiss="alert">&times;</a>
              <span id="test-error"><%= flash[:message] %></span>
            </div>
          </div>
          <div class='col-lg-4'>
            <div class="media">
              <img id="testimg" src="/" class="text-center" width="100%">
            </div>
            <div class="test-snapshot"><a href="#" id="test" class="btn btn-primary ladda-button" role="button" data-style="expand-left"><span class="ladda-label">Test Snapshot</span></a></div>
            <p class="text-center"><span data-toggle="tooltip" data-placement="top" data-title="If you have entered the correct Credentials, Camera URL/IP and Port into the fields to the left, the image above should show you what your camera is seeing right now. If there is no preview, then some of the information you have entered could be incorrect. Please check the info or refer to your Camera's Manual." class="label label-default">?</span></p>
          </div>
        </div>
      </div>
    </fieldset>
    <fieldset>
    <div class="row">
      <div class='col-lg-10 col-lg-offset-1'>
        <div class="col-lg-7">
          <!-- STEP 4 -->
          <div class='row'>
            <div class='col-lg-6 form-group'>
              <label class="control-label" for="camera-vendor">Camera Vendor</label>
              <!--<span data-toggle="tooltip" data-title="" class="label label-default">more info</span>-->
              <select id="camera-vendor" name="camera-vendor" class="form-control">
                <option selected="selected" value="-1">-- select model --</option>
                <% @vendors.each_with_index  do |v, index| -%>
                    <option value="<%= v.exid -%>" <% if v.exid == @camera['vendor'] %>selected="selected"<% end %>>
                      <%= v.name -%>
                    </option>
                <% end %>
              </select>
            </div>

            <div class='col-lg-6 form-group'>
              <%= @camera['model'] %>
              <label class="control-label" for="camera-model">Camera Model</label>
              <!--<span data-toggle="tooltip" data-title="" class="label label-default">more info</span>-->
              <% @vendors.each do |v| -%>
                  <select id="camera-model<%= v.exid -%>" name="camera-model" class="form-control  <% if v.exid != @camera['vendor'] %>hidden<% end %>">
                    <% v.vendor_models.each_with_index  do |m, index| -%>
                        <% if index == 0 %>
                            <option value="<%= m.name -%>" ><%= m.name -%></option>
                        <% else %>
                            <option value="<%= m.name  -%>" <% if m.name == @camera['model'] %>selected="selected"<% end %> ><%= m.name -%></option>
                        <% end %>
                    <% end -%>
                  </select>
              <% end %>
            </div>
          </div>
          <div class="row">
            <div class='col-lg-8 form-group'>
              <label class="control-label" for="local-ip">Local IP</label>
              <!--<span data-toggle="tooltip" data-title="" class="label label-default">more info</span>-->
              <input id="local-ip" name="local-ip" placeholder="" class="form-control" type="text" data-validation="custom" data-validation-regexp="^[a-zA-Z0-9._/-]{2,100}$"  data-validation-error-msg="The Port should be a 2-4 digit number." data-validation-optional="true" value="<%= params['local-ip'] %>">
            </div>
          </div>
          <div class="row">
            <div class='col-lg-6 form-group'>
              <label class="control-label" for="local-http">Local HTTP Port</label>
              <!--<span data-toggle="tooltip" data-title="" class="label label-default">more info</span>-->
              <input id="local-http" name="local-http" placeholder="" class="form-control" type="text" data-validation="custom" data-validation-regexp="^[0-9]{2,5}$"  data-validation-error-msg="The Port should be a 2-5 digit number." data-validation-optional="true" value="<%= params['local-http'] %>">
            </div>
            <div class='col-lg-6 form-group'>
              <label class="control-label" for="local-rtsp">Local RTSP Port</label>
              <!--<span data-toggle="tooltip" data-title="" class="label label-default">more info</span>-->
              <input id="local-rtsp" name="local-rtsp" placeholder="" class="form-control" type="text" data-validation="custom" data-validation-regexp="^[0-9]{2,5}$"  data-validation-error-msg="The Port should be a 2-5 digit number." data-validation-optional="true" value="<%= params['local-rtsp'] %>">
            </div>
          </div>


        </div>
      </div>
    </div>
    </fieldset>
    <!-- FINISH & ADD -->
    <fieldset>
      <div class='row'>
        <div class="text-center finish">
          <!-- Button -->
          <div class='col-lg-12'>
            <div class="form-group">
              <label class="control-label" for="add-button"></label>
              <button id="add-button" name="add-button" class="btn btn-primary">Save</button>
            </div>
          </div>
        </div>
      </div>
    </fieldset>

    <!-- SUPPORT -->
    <div class="row add-row add-footer">
      <div class='col-lg-5 col-lg-offset-3'>
        <h5>Still Can't See Your Camera?</h5>
        <ul class="list-inline">
          <li><a href="#">FAQ/common-connection-issues</a></li>
          <li><a href="#">Get our Support Team to connect your Camera</a></li>
        </ul>
      </div>
    </div>

  </form>
</div>



<!--SHARING TAB PANE -->
<div id="sharing" class="tab-pane">
  <!--PERMISSIONS-->
  <div class="panel panel-body">
    <div class="row">
      <div class="col-md-7 sharing">
        <h5>Permissions</h5>
        <div class="radio">
          <label>
            <input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" checked>
            <h5><span class="glyphicon glyphicon-globe"></span> Public on the web <small>Anyone on the internet can find access.</small></h5>
          </label>
        </div>
        <div class="radio">
          <label>
            <input type="radio" name="optionsRadios" id="optionsRadios2" value="option2">
            <h5><span class="glyphicon glyphicon-link"></span> Anyone with the link <small>Anyone who has the link can access. No sign in required.</small></h5>
          </label>
        </div>
        <div class="radio">
          <label>
            <input type="radio" name="optionsRadios" id="optionsRadios2" value="option2">
            <h5><span class="glyphicon glyphicon-user"></span> Specific People <small>Only people explicitly granted permission.</small></h5>
          </label>
        </div>
        <div class="form-group">
          <div class="col-sm-8">
            <button type="submit" class="btn btn-primary btn-sm">Save</button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!--USER LIST-->
  <div class="panel panel-body">
    <div class="row">
      <div class="col-md-12">
        <table class="table">
          <thead>
          <tr>
            <th>This Camera is Shared With</th>
            <th>Permissions</th>
            <th></th>
            <th></th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td>vinnie.quinn@camba.tv</td>
            <td>
              <div class="input-group input-group-sm">
                <select class="form-control">
                  <option>Read Only</option>
                  <option>Full Rights</option>
                </select>
              </div>
            </td>
            <td>
              <div class="form-group">
                <div class="col-sm-8">

                </div>
              </div>
            </td>
            <td>
              <div class="form-group">
                <div class="col-sm-8">
                  <span class="glyphicon glyphicon-remove"></span> Remove User
                </div>
              </div>
            </td>

          </tr>
          <tr>
            <td>vinnie.quinn@camba.tv</td>
            <td>
              <div class="input-group input-group-sm">
                <select class="form-control">
                  <option>Read Only</option>
                  <option>Full Rights</option>
                </select>
              </div>
            </td>
            <td>
              <div class="form-group">
                <div class="col-sm-8">

                </div>
              </div>
            </td>
            <td>
              <div class="form-group">
                <div class="col-sm-8">
                  <span class="glyphicon glyphicon-remove"></span> Remove User
                </div>
              </div>
            </td>

          </tr>
          <tr>
            <td>ciaran@evercam.io</td>
            <td>
              <div class="input-group input-group-sm">
                <select class="form-control">
                  <option>Read Only</option>
                  <option>Full Rights</option>
                </select>
              </div>
            </td>
            <td>
              <div class="form-group">
                <div class="col-sm-8">

                </div>
              </div>
            </td>
            <td>
              <div class="form-group">
                <div class="col-sm-8">
                  <span class="glyphicon glyphicon-remove"></span> Remove User
                </div>
              </div>
            </td>

          </tr>

          </tbody>
          <tfoot>
          <tr>
            <td colspan="4">
              <button type="submit" class="btn btn-primary btn-sm">Save</button>
            </td>
          </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!--ADD A USER-->
  <div class="panel panel-body">
    <div class="row">
      <div class="col-md-12">
        <h5><span class="glyphicon glyphicon-plus"></span>  Add A User</h5>
      </div>
    </div>

    <div class="row add-user">
      <div class="col-md-5">
        <div class="input-group input-group-sm">
          <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
          <input type="email" placeholder="email@domain.com" class="form-control" id="inputEmail3">
        </div>
      </div>
      <div class="col-md-2">
        <div class="input-group input-group-sm">
          <select class="form-control">
            <option>Read Only</option>
            <option>Full Rights</option>
          </select>
        </div>
      </div>
      <div class="col-md-1">
        <div class="form-group">
          <button type="submit" class="btn btn-primary btn-sm">Invite</button>
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
          <input type="checkbox"> Send Notification
        </div>
      </div>
    </div>
  </div>
  <!--LINK TO SHARE-->
  <div class="panel panel-body">
    <div class="row">
      <div class="col-md-8">
        <h5><span class="glyphicon glyphicon-globe"></span>  Link to Share</h5>
        <div class="well well-sm">...</div>
      </div>
    </div>
  </div>
</div>


<!--APPS TAB PANE -->
<div id="apps" class="tab-pane">

  <a href="http://www.evercam.io/apps" class="btn apps-btn">View <span class="evercam"> /Apps </span> To Add To Your Camera</a>

</div><!--TAB PANE -->

<!--ACTIVITY TAB PANE -->
<div id="activity" class="tab-pane">
  <p>ACTIVITY</p><p>coming soon...</p>
</div><!--TAB PANE -->

<!--LOGS TAB PANE -->
<div id="logs" class="tab-pane">
  <p>LOGS</p><p>coming soon...</p>
</div><!--TAB PANE -->

<!--EXPLORER TAB PANE -->
<div id="explorer" class="tab-pane">
  <p>API EXPLORER</p><p>coming soon...</p>
</div><!--TAB PANE -->

<!--DELETE TAB PANE -->
<div id="delete" class="tab-pane">
  <div class="col-md-6 panel panel-body">
    <p class="strong">Are you sure you want to DELETE this camera?</p>
   <%= link_to @camera, method: :delete, class:"btn btn-danger", role:"button" do %>
    <span class="glyphicon glyphicon-remove"></span>Yes, DELETE this Camera</a>
   <% end %>
    <a href="#live" data-toggle="tab" class="btn btn-primary" role="button"><span class="glyphicon glyphicon-ok"></span>No, CANCEL</a>
  </div>
</div><!--TAB PANE -->

</div><!-- tab-content -->
</div><!-- tab-content -->



</div><!-- 12 -->

</div><!-- Row -->
</section><!-- Section Wrapper -->


</section>
</div> <!--container clearfix END -->
</div> <!--boxed page end-->
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-form-validator/2.1.47/jquery.form-validator.min.js"></script>
<script>

    $(function () {
        var previous;
        $('#camera-vendor').one('focus', function() {
            previous = this.value;
        }).on('change', function() {
            $('#camera-model' + previous).addClass('hidden');
            $('#camera-model' + this.value).removeClass('hidden');
            previous = this.value;
        });

        $('#test').click(function(e) {
            var params = ['external_url=http://' + $('#camera-url').val() + ':' + $('#port').val(), 'jpg_url=' + $('#snapshot').val(),
                'cam_username=' + $('#camera-username').val(), 'cam_password=' + $('#camera-password').val()];
            e.preventDefault();
            var l = Ladda.create(this);
            l.start();
            var progress = 0;
            var interval = setInterval( function() {
                progress = Math.min( progress + 0.025, 1 );
                l.setProgress( progress );

                if( progress === 1 ) {
                    l.stop();
                    clearInterval( interval );
                }
            }, 200 );
            $.getJSON('https://api.evercam.io/v1/cameras/test.json?' + params.join('&'))
                    .done(function(resp) {
                        console.log('success');
                        $('#testimg').attr('src', resp.data);
                    })
                    .fail(function(resp) {
                        $('#test-error').text(resp.responseJSON.message);
                        console.log('error');
                    })
                    .always(function() {
                        l.stop();
                        clearInterval( interval );
                    });
        });

        // Tooltip
        $('body').popover({
            selector: '[data-toggle="popover"]'
        });

        $('body').tooltip({
            selector: 'a[rel="tooltip"], [data-toggle="tooltip"]'
        });

        $.getJSON('https://api.evercam.io/v1/cameras/test.json?' + params.join('&'))
                .done(function(resp) {
                    console.log('success');
                    $('#testimg').attr('src', resp.data);
                })
                .fail(function(resp) {
                    $('#test-error').text(resp.responseJSON.message);
                    console.log('error');
                })
                .always(function() {
                    l.stop();
                    clearInterval( interval );
                });
    });
    // Javascript to enable link to tab
    var url = document.location.toString();
    if (url.match('#')) {
        $('.nav-tabs a[href=#'+url.split('#')[1]+']').tab('show');
        setTimeout(function() {scrollTo(0,0)}, 10);
    }

    // Change hash for page-reload
    $('.nav-tabs a').on('shown.bs.tab', function (e) {
        window.location.hash = e.target.hash;
        scrollTo(0,0);
    })


    $( '.refresh' ).click(function() {
        location.reload();
    });

    })
</script>

