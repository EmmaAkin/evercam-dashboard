<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<section id="unseen" class="row">
    <div class="col-md-6">
      <div class="portlet">
        <div class="portlet-title">
          <div class="caption">
            <i class="fa fa-info"></i> General Info
          </div>
      </div>
      <div class="portlet-body col-md-6">
        <table class="table table-borderless margin-top-5">
          <tr>
            <td>Status:</td>
            <td>
              <% if @camera['is_online'] %>
                <span class="green">Online</span>
              <% else %>
                <span class="red">Offline</span>
              <% end %>
            </td>
          </tr>
          <tr>
            <td>Evercam ID:</td>
            <td>
              <span id="ec_cam_id">
                <%= @camera['id'] %>
              </span></td>
          </tr>
          <tr>
            <td>Owner:</td>
            <td><%= @camera['owner'] %></td>
          </tr>
          <tr>
            <td>Vendor:</td>
            <td><%= @camera["vendor_name"] %></td>
          </tr>

          <tr>
            <td>Model:</td>
            <td><%= @camera['model'] %>

            </td>
          </tr>
          <tr>
            <td>Date Added:</td>
            <td><%= Time.at(@camera['created_at']).to_formatted_s(:long_ordinal) %></td>
          </tr>
        </table>
     </div>​
    </div>
    </div>



  <div class="col-md-6">
  <div class="portlet">
    <div class="portlet-title">
      <div class="caption">
        <i class="fa fa-camera"></i> Live View
      </div>
    </div>
    <div class="portlet-body">
      <div class="info-preview">

        <% if @camera['is_online'] %>
          <%= preview(@camera, true) %>
        <% else %>
          <div class="tint"><%= preview(@camera, true ) %></div>
        <% end %>

      </div>
    </div>​
  </div>
  </div>



  </section>
<div class="row margin-top-20">
<div class="col-md-6">
  <div class="portlet">


      <div class="portlet-title">
        <div class="caption">
          <i class="fa fa-external-link"></i> URLS
        </div>
      </div>

    <div class="portlet-body">

  <section id="unseen">
    <table class="table table-borderless">
      <thead>
      <tr>
        <th class="col-md-4 first-row">
          Proxy URLs
        </th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>
          <span class="dark-grey">JPEG:</span>
        <span id="public-short-link" class="show-on-public" style="<%= 'display: none;' unless @camera['is_public'] %>">
            <%= link_to "http://evr.cm/#{@camera['id']}.jpg", "http://evr.cm/#{@camera['id']}.jpg", target: '_blank', :only_path => false %></span>
          <span id="private-short-link" class="show-on-private" style="<%= 'display: none;' if @camera['is_public'] %>">
            <%= "http://evr.cm/#{@camera['id']}.jpg" %>
            <p class="grey"> (Only available for public cameras, you can change your settings <a class="open-sharing" href="#sharing">here</a>)</p></span>
        </td>
      </tr>
      </tbody>
    </table>
  </section>

  <section id="unseen">
    <table class="table table-borderless">
      <thead>
      <tr>
        <th class="col-md-4 first-row">
          Dynamic DNS URLs
        </th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>
          <span class="dark-grey">JPEG:</span>
          <% if url = @camera.deep_fetch(:dyndns, :http, :jpg) {} %>
          <%= link_to_unless(url.nil?, url, url, target: '_blank', :only_path => false) %>
            <% else %>
             <span class="grey">Not available</span>
            <% end %>
        </td>
      </tr>
      </tbody>
    </table>
  </section>

  <section id="unseen">
    <table class="table table-borderless">
      <thead>
      <tr>
        <th class="col-md-4 first-row">
          Base URLs
        </th>

      </tr>
      </thead>
      <tbody>
      <tr>
        <td>
          <span class="dark-grey">Camera:</span>
          <% if url = @camera.deep_fetch(:external, :http, :camera) {} %>
          <%= link_to_unless(url.nil?, url, url, target: '_blank', :only_path => false) %>
          <% else %>
            <span class="grey">Not available</span>
          <% end %>
        </td>
      </tr>
      <tr>
        <td>
          <span class="dark-grey">JPEG:</span>
          <% if url = @camera.deep_fetch(:external, :http, :jpg) {} %>
          <%= link_to_unless(url.nil?, url, url, target: '_blank', :only_path => false) %>
          <% else %>
            <span class="grey">Not available</span>
          <% end %>
        </td>
      </tr>
      <tr>
        <td>
          <span class="dark-grey">MJPEG:</span>
          <% if url = @camera.deep_fetch(:external, :http, :mjpg) {} %>
          <%= link_to_unless(url.nil?, url, url,  :only_path => false) %>
          <% else %>
          <span class="grey">Not available</span>
          <% end %>
        </td>
      </tr>
      <tr>
        <td>
          <span class="dark-grey">MPEG:</span>
          <% if url = @camera.deep_fetch(:external, :rtsp, :mpeg) {} %>
          <%= link_to_unless(url.nil?, url, url,  :only_path => false) %>
          <% else %>
            <span class="grey">Not available</span>
          <% end %>
        </td>
      </tr>
      <tr>
        <td>
          <span class="dark-grey">Audio:</span>
          <% if url = @camera.deep_fetch(:external, :rtsp, :audio) {} %>
          <%= link_to_unless(url.nil?, url, url,  :only_path => false) %>
          <% else %>
            <span class="grey">Not available</span>
          <% end %>
        </td>
      </tr>
      <tr>
        <td>
          <span class="dark-grey">H264:</span>
          <% if url = @camera.deep_fetch(:external, :rtsp, :h264) {} %>
          <%= link_to_unless(url.nil?, url, url,  :only_path => false) %>
          <% else %>
            <span class="grey">Not available</span>
          <% end %>
        </td>
      </tr>
      </tbody>
    </table>
  </section>
  </div>
  </div>
</div><!-- end column 6-->

  <div class="col-md-6 info-location">
    <div class="portlet">
      <div class="portlet-title">
        <div class="caption">
          <i class="fa fa-map-marker"></i> Location
        </div>
      </div>
      <div class="portlet-body">
        <div id="map-info"></div>
      </div>​
    </div>
  </div>
</div>


  <%= javascript_tag do %>
    cameraLong = '<%= @camera.deep_fetch(:location, :lng) {} %>';
    cameraLat = '<%= @camera.deep_fetch(:location, :lat) {} %>';
  <% end %>

<script type="text/javascript">
  $(window.Evercam.Info.initializeTab);
  $(document).ready(function() {
    if (cameraLong === '') {
      $('#info-location').replaceWith("<p>Not set</p>");
      return;
    }
  });

  function initialize() {
    if (cameraLong === '') {
      $('#map-info').replaceWith("<p>The location of this camera is not set.</p>");
      return;
    }
    var cameraLatlng = new google.maps.LatLng(cameraLat, cameraLong);
    var mapOptions = {
      zoom: 8,
      center: cameraLatlng,

    }
    var map = new google.maps.Map(document.getElementById('map-info'), mapOptions);

    var marker = new google.maps.Marker({
      position: cameraLatlng,
      map: map,
      title: 'Camera Location'
    });

    var mapFirstClick = false;
    $("#nav-tabs-2").click(function() {
      mapFirstClick || setTimeout(function() {
        google.maps.event.trigger(map, 'resize');
        mapFirstClick = true;
        map.setCenter(cameraLatlng);
      }, 200);
    });

  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>