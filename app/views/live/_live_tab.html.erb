<div class="camera-preview">
  <% if @camera['is_online'] && @camera['is_public'] %>
    <img id="myImage" src="https://api.evercam.io/v1/cameras/<%= @camera['id'] %>/snapshot.jpg?api_id=<%= current_user.api_id -%>&api_key=<%= current_user.api_key -%>" onerror="imgError(this);">
  <% else %>
    <div><%= preview(@camera, true) %></div>
  <% end %>
</div>

<script type="text/javascript">
  $(window.Evercam.Live.initializeTab);
  <% if @camera['is_online'] && @camera['is_public'] %>

  setInterval(function() {
    var myImageElement = document.getElementById('myImage');
    myImageElement.src = 'https://api.evercam.io/v1/cameras/<%= @camera["id"] %>/snapshot.jpg?api_id=<%= current_user.api_id -%>&api_key=<%= current_user.api_key -%>?rand=' + new Date().getTime();
  }, 1000);
  <% else %>
  <% end %>

  function imgError(image) {
    image.onerror = "";
    image.src = "https://www.evercam.io/img/live-error.png";
    return true;
  }
</script>
