<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
<div class="page-container" id="public-index">
  <!-- sidebar menu start-->
  <div class="page-sidebar-wrapper">
    <div class="page-sidebar navbar-collapse collapse">

      <ul id="nav-accordion" class="page-sidebar-menu" data-auto-scroll="true" data-slide-speed="200">
        <!--<li class="sidebar-toggler-wrapper">
          <div class="sidebar-toggler">
          </div>
        </li>-->
        <li>
          <a href="/">Camera Dashboard</a>
        </li>
        <li>
          <a class="public-cam" href="/publiccam">Public Cameras</a>
        </li>

        <li>
          <a href="/cameras/new">Add Camera</a>
        </li>
        <li>
          <a href="javascript:;" class="active">
            <span class="title open">Developer</span>
            <span class="caret"></span>
          </a>
          <ul class="sub-menu">
            <li class="active">
              <a href="/dev">
                API</a>
            </li>
            <li>
              <a href="/widgets-new">
                <span class="title">Widgets</span>
                <span class="caret"></span>
              </a>
              <ul class="sub-menu">
                <li>
                  <a href="/widgets-new">
                    Live View</a>
                </li>
              </ul>
            </li>
          </ul>
        </li>

      </ul>
    </div>
  </div>
  <!-- sidebar menu end-->
  <div class="page-content-wrapper">
    <div class="page-content">
      <!--main content start-->
      <div id="map"></div>
      <p><b>Address</b>: <span id="address"></span></p>
      <p id="error"></p>
    </div>
  </div>
</div>

<%= javascript_tag do %>
  cameraLong = '<%= @camera.deep_fetch(:location, :lng) {} %>';
  cameraLat = '<%= @camera.deep_fetch(:location, :lat) {} %>';
<% end %>

<script>
  function initialize() {
    if (cameraLong === '') {
      $('#map-canvas').replaceWith("<p>The location of this camera was not found</p>");
      return;
    }
    var cameraLatlng = new google.maps.LatLng(cameraLat, cameraLong);
    var mapOptions = {
      zoom: 8,
      center: cameraLatlng,

    }
    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    var marker = new google.maps.Marker({
      position: cameraLatlng,
      map: map,
      title: 'Camera Location'
    });

    var mapFirstClick = false;
    $("#nav-tabs").click(function() {
      mapFirstClick || setTimeout(function() {
        google.maps.event.trigger(map, 'resize');
        mapFirstClick = true;
        map.setCenter(cameraLatlng);
      }, 200);
    });

  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>
