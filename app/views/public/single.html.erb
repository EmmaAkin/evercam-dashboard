<%= content_for(:title, "Evercam: Public Camera") %>
<script src="https://maps.google.com/maps/api/js?sensor=true"></script>
<div class="bb-alert alert alert-info" style="display:none;">
  <span></span>
</div>
<div class="page-container" id="public-single">
  <!-- BEGIN SIDEBAR -->
  <%= render :partial => "sidebar/sidebar" %>
  <!-- END SIDEBAR -->
  <div class="page-content-wrapper">
    <div class="page-content">

      <div class="row">
        <div class="camera-title">
          <div class="col-xs-6 col-md-6">
            <h3 class="page-title"><%= @camera['name'] %><small>   <%= @camera['id'] %></small></h3>
          </div>
          <div id="status" class="col-md-6 col-sm-6">
            <% if @camera['is_online'] %>
              <h5 class="green pull-right"><i class="fa fa-check"></i>Online</h5>
            <% else %>
              <h5 class="red pull-right">Offline</h5>
            <% end %>
          </div>
        </div>
      </div>

      <div class="row margin-bottom-15">
        <div class="col-xs-6 col-md-6">
          <a href="/public/cameras/"><span class="icon-arrow-left"></span>Public Cameras</a>
        </div>
        <div class="pull-right col-xs-6 col-md-6">
          <a href="#" class="pull-right" camera_id="<%= @camera["id"] %>" email="<%= @user.email %>">Add to Cameras Shared With Me <i class="icon-plus"></i></a>
        </div>
      </div>

      <div id="public-cam-single">
        <div class="portlet">
          <div class="tabbable tabbable-custom">
            <div class="tab-content">
              <div class="row">
                <div class="col-md-6">
                  <div id="public-info" class="portlet-body">
                    <div class="portlet solid bordered grey-cararra">
                      <div class="portlet-title">
                        <div class="caption">
                          Live View
                        </div>
                      </div>
                      <div class="portlet-body">
                        <div class="info-preview">
                          <div class="camera-preview">
                            <!--     <div>
                                  <a href="#" id="info-refresh" class="refresh"><span class="glyphicon glyphicon-refresh">  </span>  Refresh</a>
                                </div>-->
                            <% if @camera['is_online'] %>
                              <%= preview(@camera, true) %>
                            <% else %>
                              <div class="tint"><%= preview(@camera, true ) %></div>

                              <!--<div class="offline-public">
                                <div class="offline-text">
                                  <p>This camera appears to be offline.</p>
                                  <p>We are currently unable to fetch a snapshot.</p>
                                </div>
                              </div>-->
                            <% end %>
                          </div>
                        </div>​
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-6">
                  <div id="public-info" class="portlet-body">
                    <div class="portlet solid bordered grey-cararra">
                      <div class="portlet-title">
                        <div class="caption">
                          Camera Details
                        </div>
                      </div>
                      <div class="portlet-body">
                        <table class="table table-fixed table-borderless">
                          <tr>
                            <td class="col-md-2">Status:</td>
                            <td class="col-md-8">
                              <% if @camera['is_online'] %>
                                <span class="green">Online</span>
                              <% else %>
                                <span class="red">Offline</span>
                              <% end %>
                            </td>
                          </tr>
                          <tr>
                            <td>Owner:</td>
                            <td><%= @camera['owner'] %></td>
                          </tr>
                          <tr>
                            <td>Vendor:</td>
                            <td>
                              <% if @camera["vendor_name"] != nil %>
                                <%= @camera["vendor_name"] %>
                              <% else %>
                                <span class="grey">Unknown</span>
                              <% end %>
                            </td>
                          </tr>
                          <tr>
                            <td>Model:</td>
                            <td>
                              <% if @camera["model_name"] != nil %>
                                <%= @camera["model_name"] %>
                              <% else %>
                                <span class="grey">Unknown</span>
                              <% end %>
                            </td>
                          </tr>
                          <tr>
                            <td>Date Added:</td>
                            <td><%= Time.at(@camera['created_at']).to_formatted_s(:long_ordinal) %></td>
                          </tr>
                        </table>
                      </div>
                    </div>
                  </div>
                </div><!-- end col-md-6-->

                  <div class="col-md-6">
                    <div id="public-info" class="portlet-body">
                      <div class="portlet solid bordered grey-cararra">
                        <div class="portlet-title">
                          <div class="caption">
                            Location
                          </div>
                        </div>
                        <div class="portlet-body">
                          <div class="info-preview">
                            <div class="row">
                              <div class="col-md-6">
                                <div id="map-public"></div>
                              </div>
                              <div id="pub-location" class="col-md-6">
                                Coordinates<br /><p><%= @camera.deep_fetch(:location, :lat) {} %>, <%= @camera.deep_fetch(:location, :lng) {} %></p>
                              </div>
                            </div>
                          </div>​
                        </div>
                      </div>
                    </div>
                  </div>

              </div><!--row -->
            </div><!--tab ccontent-->
          </div><!--end tabbable custom-->
        </div><!--portlet-->
      </div><!--public-cam-single-->

    </div>
  </div>
  <input type="button" value="Click me..." onclick="alert(address);" />

  <%= javascript_tag do %>
    cameraLong = '<%= @camera.deep_fetch(:location, :lng) {} %>';
    cameraLat = '<%= @camera.deep_fetch(:location, :lat) {} %>';
    <% end %><%= javascript_include_tag "publiccam" %>
<script>
  $(window.Evercam.Publiccam.initialize);


  jQuery(document).ready(function() {
    Metronic.init(); // init metronic core components
    Layout.init(); // init current layout
    QuickSidebar.init() // init quick sidebar
  });


  $(document).ready(function() {
    if (cameraLong === '0') {
      $('#pub-location').replaceWith("<p></p>");
      $('#map-public').replaceWith("<p>The location of this camera has not been set.</p>");
      return;
    }
  });

  function initialize() {
    var cameraLatlng = new google.maps.LatLng(cameraLat, cameraLong);
    var mapOptions = {
      zoom: 12,
      center: cameraLatlng,
      mapTypeControl: false,
      streetViewControl: false
    }
    var map = new google.maps.Map(document.getElementById('map-public'), mapOptions);

    var marker = new google.maps.Marker({
      position: cameraLatlng,
      map: map,
      title: 'Camera Location'
    });

  }
  google.maps.event.addDomListener(window, 'load', initialize);

/**/
  var menuLeft = document.getElementById( 'cbp-spmenu-s1' ),
      showLeft = document.getElementById( 'showLeft' )
  body = document.body;

  showLeft.onclick = function() {
    classie.toggle( this, 'active' );
    classie.toggle( menuLeft, 'cbp-spmenu-open' );
    disableOther( 'showLeft' );
  };


  function disableOther( button ) {
    if( button !== 'showLeft' ) {
      classie.toggle( showLeft, 'disabled' );
    }

  }


</script>
