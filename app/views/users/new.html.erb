<% provide(:title, "Create New Account") %>

<section id="new-account" class="site-min-height">
  <div class="container section" id="new-account">
    <div id="signin" class="col-md-12 text-center">
      <div class="bb-alert alert alert-danger" style="display:none;">
        <span></span>
      </div>
      <div class="branding margin-bottom-50">
        <%= link_to root_path, class: 'sign-in-logo' do %>
          <%= image_tag("evercam_logo.svg", :class => "svg-logo", alt: "Evercam.io") %>
        <% end %>
      </div>
    </div>

    <div id="registration" class="col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3 col-sm-8 col-sm-offset-2">
      <div class="col-sm-10 col-sm-offset-1 row">
        <h3 class="text-center">Create a free Account</h3>
        <%= form_for(:user, url: signup_path) do |f| %>
          <% field_errors = (flash[:field_errors] || {}) %>

          <div class="row text-center">
            <div class="col-sm-3">
              <%= f.label :firstname, 'First Name' %>
            </div>
            <div class="col-sm-9 form-group<%= field_errors.include?("firstname") ? " has-error" : "" %>">
              <%= f.text_field :firstname, value: params.fetch('user', {})[:firstname], class: "form-control" %>
              <% if field_errors.include?("firstname") %>
                <span class="help-block arrow_box form-error text-left"><%= field_errors["firstname"] %></span>
              <% end %>
            </div>
          </div>

          <div class="row text-center">
            <div class="col-sm-3">
              <%= f.label :lastname, 'Last Name' %>
            </div>
            <div class="col-sm-9 form-group<%= field_errors.include?("lastname") ? " has-error" : "" %>">
              <%= f.text_field :lastname, value: params.fetch('user', {})[:lastname], class: "form-control" %>
              <% if field_errors.include?("lastname") %>
                <span class="help-block arrow_box form-error text-left"><%= field_errors["lastname"] %></span>
              <% end %>
              <!-- Plan to join First and Last Name to one Input -->
            </div>
          </div>

          <div class="row text-center">
            <div class="col-sm-3">
              <%= f.label :username %>
            </div>
            <div class="col-sm-9 form-group<%= field_errors.include?("username") ? " has-error" : "" %>">
              <%= f.text_field :username, value: params.fetch('user', {})[:username], class: "form-control", "data-validation" => "custom", "data-validation-regexp" => '^[a-z]+[\w-]+$', "data-validation-error-msg" => "Only lower case letters, numbers, dashes & underscores allowed." %>
              <% if field_errors.include?("username") %>
                <span class="help-block arrow_box form-error text-left"><%= field_errors["username"] %></span>
              <% end %>
            </div>
          </div>

          <div class="row text-center">
            <div class="col-sm-3">
              <%= f.label :country %>
            </div>
            <div class="col-sm-9 form-group<%= field_errors.include?("country") ? " has-error" : "" %>">
              <%= f.country_select :country, selected: params.fetch('user', {})[:country] %>
              <% if field_errors.include?("country") %>
                <span class="help-block arrow_box form-error text-left"><%= field_errors["country"] %></span>
              <% end %>
            </div>
          </div>

          <div class="row text-center">
            <div class="col-sm-3">
              <%= f.label :email, 'Email' %>
            </div>
            <div class="col-sm-9 form-group<%= field_errors.include?("email") ? " has-error" : "" %>">
              <% if @share_request.nil? %>
                <%= f.text_field :email, value: params.fetch('user', {})[:email], class: "form-control" %>
              <% else %>
                <%= f.text_field :email, value: @share_request.email, readonly: 'readonly', class: "form-control" %>
              <% end %>
              <% if field_errors.include?("email") %>
                <span class="help-block arrow_box form-error text-left"><%= field_errors["email"] %></span>
              <% end %>
            </div>
          </div>

          <div class="row text-center">
            <div class="col-sm-3">
              <%= f.label :password %>
            </div>
            <div class="col-sm-9 form-group<%= field_errors.include?("password") ? " has-error" : "" %>">
              <%= f.password_field :password, autocomplete: "off", class: "form-control" %>
              <% if field_errors.include?("password") %>
                <span class="help-block form-error arrow_box text-left"><%= field_errors["password"] %></span>
              <% end %>
            </div>
          </div>
          <div class="text-center create">
            <%= f.submit "Create New Account", class: "btn btn-large btn-primary" %>
          </div>
          <div class="row text-center">
            <p class="col-md-12 use">Signing up signifies that you've read and agree to our
              <a href="http://www.evercam.io/terms" target="blank">Terms of Use</a></p>
          </div>

          <% if @share_request %>
            <input type="hidden" name="key" id="key" value="<%= @share_request.key %>"/>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="col-md-4 col-md-offset-4 col-sm-8 col-sm-offset-2 row text-center create">
      <p>Already have an account? <%= link_to "Sign in", signin_path %></p>
    </div>
  </div>
</section>

<script>
  $(function () {
    $("alert").on("click", function () {
      $("." + $(this).attr("data-hide")).hide();
    });
  });
  $.validate()
</script>
