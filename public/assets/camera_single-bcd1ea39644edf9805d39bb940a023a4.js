(function(){var e,t,a,r,n,i,s,c,o,u,l,d,p,h;p=function(e){return Notification.show(e),!0},h=function(e){return Notification.show(e),!0},d=function(e){var t,a;return a=$('meta[name="csrf-token"]'),a.size()>0&&(t={"X-CSRF-Token":a.attr("content")},e.headers=t),jQuery.ajax(e),!0},e=function(e){var t,a,r,u,l,d,p,h;return l=$("<tr>"),"share_request"===e.type?l.attr("share-request-id",e.share_id):l.attr("share-id",e.share_id),a=$("<td>",{"class":"col-lg-4"}),a.append($("<span>",{"class":"glyphicon glyphicon-user"})),a.append(document.createTextNode(" "+e.email)),"share_request"===e.type&&(h=$("<small>",{"class":"blue"}),h.text(" ...pending"),a.append(h)),l.append(a),a=$("<td>",{"class":"col-lg-2"}),r=$("<div>",{"class":"input-group input-group-sm"}),d=$("<select>",{"class":"form-control reveal","show-class":"show-save"}),d.focus(s),u=$("<option>",{value:"minimal"}),"full"!==e.permissions&&u.attr("selected","selected"),u.text("Read Only"),d.append(u),u=$("<option>",{value:"full"}),"full"===e.permissions&&u.attr("selected","selected"),u.text("Full Rights"),d.append(u),r.append(d),a.append(r),l.append(a),a=$("<td>",{"class":"col-lg-2"}),t=$("<button>",{"class":"save show-save btn btn-primary bt-sm"}),t.text("Save"),t.click("share"===e.type?c:o),a.append(t),l.append(a),a=$("<td>",{"class":"col-lg-2"}),r=$("<div>",{"class":"form-group"}),p=$("<span>"),p.append($("<span>",{"class":"glyphicon glyphicon-remove"})),"share"===e.type?(p.addClass("delete-share-control"),p.append($(document.createTextNode(" Remove User"))),p.click(n),p.attr("share_id",e.share_id)):(p.addClass("delete-share-request-control"),p.append($(document.createTextNode(" Revoke Request"))),p.click(i),p.attr("email",e.email)),p.attr("camera_id",e.camera_id),r.append(p),a.append(r),l.append(a),l.hide(),$("#sharing_list_table tbody").append(l),l.fadeIn(),!0},u=function(e){var t,a,r,n,i,s,c;switch(e.preventDefault(),s=$("input[name=sharingOptionRadios]:checked").val(),t=$("#set_permissions_submit"),a=$("#sharing_tab_camera_id").val(),r={},s){case"public_discoverable":r["public"]=!0,r.discoverable=!0,$("#public-short-link").show(),$("#private-short-link").hide();break;case"public_undiscoverable":r["public"]=!0,r.discoverable=!1,$("#public-short-link").show(),$("#private-short-link").hide();break;default:r["public"]=!1,r.discoverable=!1,$("#public-short-link").hide(),$("#private-short-link").show()}return n=function(){return p("Update of camera permissions failed. Please contact support."),t.removeAttr("disabled"),!1},i=function(e){return e.success?h("Camera permissions successfully updated."):p("Update of camera permissions failed. Please contact support."),t.removeAttr("disabled"),!0},c={cache:!1,data:r,dataType:"json",error:n,success:i,type:"POST",url:"/share/camera/"+a},t.attr("disabled","disabled"),d(c),!0},n=function(e){var t,a,r,n,i,s;return e.preventDefault(),t=$(e.currentTarget),i=t.parent().parent().parent(),a={camera_id:t.attr("camera_id"),share_id:t.attr("share_id")},r=function(){return p("Delete of camera shared failed. Please contact support."),!1},n=function(e){var t;return e.success?(t=function(){return i.remove()},i.fadeOut("slow",t)):p("Delete of camera shared failed. Please contact support."),!0},s={cache:!1,data:a,dataType:"json",error:r,success:n,type:"DELETE",url:"/share"},d(s),!0},i=function(e){var t,a,r,n,i,s;return e.preventDefault(),t=$(e.currentTarget),i=t.parent().parent().parent(),a={camera_id:t.attr("camera_id"),email:t.attr("email")},r=function(){return p("Delete of share request failed. Please contact support."),!1},n=function(e){var t;return e.success?(t=function(){return i.remove()},i.fadeOut("slow",t)):p("Delete of share request failed. Please contact support."),!0},s={cache:!1,data:a,dataType:"json",error:r,success:n,type:"DELETE",url:"/share/request"},d(s),!0},r=function(a){var r,n,i,s;return a.preventDefault(),r=$("#sharingUserEmail").val(),s="Full Rights"!==$("#sharingPermissionLevel").val()?"minimal":"full",n=function(){return p("Add camera shared failed."),!1},i=function(t){return t.success?("share"===t.type?(e(t),h("Camera successfully shared with User")):("share_request"===t.type,e(t),h("A notification email has been dispatched to the specified email address.")),$("#sharingUserEmail").val("")):p("Adding a User failed."),!0},t($("#sharing_tab_camera_id").val(),r,s,i,n),!0},c=function(e){var t,a,r,n,i,s,c;return e.preventDefault(),t=$(this),s=t.parent().parent(),a=s.find("select"),r={permissions:a.val()},n=function(){return p("Update of share failed. Please contact support."),!1},i=function(e){return e.success?(h("Share successfully updated."),t.fadeOut()):p("Update of share failed. Please contact support."),!0},c={cache:!1,data:r,dataType:"json",error:n,success:i,type:"PATCH",url:"/share/"+s.attr("share-id")},d(c),!0},o=function(e){var t,a,r,n,i,s,c;return e.preventDefault(),t=$(this),s=t.parent().parent(),a=s.find("select"),r={permissions:a.val()},n=function(){return p("Update of share request failed. Please contact support."),!1},i=function(e){return e.success?(h("Share request successfully updated."),t.fadeOut()):p("Update of share request failed. Please contact support."),!0},c={cache:!1,data:r,dataType:"json",error:n,success:i,type:"PATCH",url:"/share/request/"+s.attr("share-request-id")},d(c),!0},t=function(e,t,a,r,n){var i,s;return i={camera_id:e,email:t,permissions:a},s={cache:!1,data:i,dataType:"json",error:n,success:r,type:"POST",url:"/share"},d(s),!0},s=function(){return $(this).parent().parent().parent().find("td:eq(2) button").fadeIn(),!0},l=function(){var e;return e=$(this).val(),$("div.desc").hide(),$("#Shares"+e).show(),!0},a=function(){return $("#set_permissions_submit").click(u),$(".delete-share-control").click(n),$(".delete-share-request-control").click(i),$("#submit_share_button").click(r),$(".update-share-button").click(c),$(".update-share-request-button").click(o),$(".save").hide(),$(".reveal").focus(s),$("input[name$='sharingOptionRadios']").click(l),Notification.init(".bb-alert"),!0},window.Evercam||(window.Evercam={}),window.Evercam.Share={initializeTab:a,createShare:t}}).call(this),function(){var e,t;t=function(){return!0},e=function(){return $("#set_permissions_submit").click(t),$("img.snap").each(function(){var e;return e=$(this),$("<img />").attr("src",$(this).attr("data-proxy")).load(function(){return this.complete&&void 0!==this.naturalWidth&&0!==this.naturalWidth?e.replaceWith($(this)):console.log("camera offline")})}),!0},window.Evercam||(window.Evercam={}),window.Evercam.Live={initializeTab:e}}.call(this),function(){var e,t,a,r,n,i,s;r=function(){return!0},s=function(){return $(".nav-tabs a[href=#sharing]").tab("show"),setTimeout(function(){return scrollTo(0,0)},10)},t=function(e){return e.preventDefault(),i(!0),!0},n=function(e){return $("#change_owner_error").text(e),""===e?$("#change_owner_error").hide():$("#change_owner_error").show(),!0},a=function(e){var t,a,r,s,c,o;return e.preventDefault(),r=$("#new_owner_email"),""!==r.val()&&(a=$("#change_owner_dialog"),a.modal("hide"),n(""),s=function(){return n("An error occurred transferring ownership of this camera. Please try again and, if the problem persists, contact support."),i(!1),!0},c=function(e){var t;return e.success?(alert("Camera ownership has been successfully transferred."),t=window.location,t.assign(t.protocol+"//"+t.host)):(n(e.message),i(!1)),!0},t={camera_id:$("#change_owner_camera_id").val(),email:r.val()},o={cache:!1,data:t,error:s,success:c,url:"/cameras/transfer"},jQuery.ajax(o)),!0},i=function(e){var t;return e&&($("#new_owner_email").val(""),$("#change_owner_error").hide()),$("#change_owner_dialog").modal("show"),t=function(){return $("#new_owner_email").select()},setTimeout(t,200),!0},e=function(){return $("#set_permissions_submit").click(r),$(".open-sharing").click(s),$("#change_owner_button").click(t),$("#submit_change_owner_button").click(a),!0},window.Evercam||(window.Evercam={}),window.Evercam.Info={initializeTab:e}}.call(this),function(){var e,t;t=function(){return!0},e=function(){return $("#set_permissions_submit").click(t),!0},window.Evercam||(window.Evercam={}),window.Evercam.Settings={initializeTab:e},jQuery(function(){return $("div").tooltip()})}.call(this),function(){var e,t;t=function(){return!0},e=function(){return $("#set_permissions_submit").click(t),!0},window.Evercam||(window.Evercam={}),window.Evercam.Explorer={initializeTab:e}}.call(this),function(){var e,t,a,r;t=null,r=function(){var e,a,r,n,i,s;return e=$("#exid").val(),n=$("#current-page").val(),s=[],$.each($("input[name='type']:checked"),function(){return s.push($(this).val())}),a=new Date($("#datetimepicker").val()).getTime()/1e3,i=new Date($("#datetimepicker2").val()).getTime()/1e3,r="",isNaN(a)||(r+="&from="+a),isNaN(i)||(r+="&to="+i),t.ajax.url($("#base-url").val()+"&page="+n+"&types="+s.join()+r).load(),!0},a=function(){return $("#all-types").is(":checked")?$("input[name='type']").prop("checked",!0):$("input[name='type']").prop("checked",!1)},e=function(){return $("#apply-types").click(r),$(".datetimepicker").datetimepicker(),$("#all-types").click(a),jQuery.fn.DataTable.ext.type.order["string-date-pre"]=function(e){return moment(e,"MMMM Do YYYY, H:mm:ss").format("X")},t=$("#logs-table").DataTable({ajax:{url:$("#ajax-url").val(),dataSrc:"logs",error:function(e){return Notification.show(e.responseJSON.message)}},columns:[{data:function(e){return moment(1e3*e.done_at).format("MMMM Do YYYY, H:mm:ss")},orderDataType:"string-date",type:"string-date"},{data:function(e){return"shared"===e.action||"stopped sharing"===e.action?e.action+" with "+e.extra["with"]:e.action},className:"log-action"},{data:function(e){return"online"===e.action||"offline"===e.action?"System":e.who}}],iDisplayLength:50,order:[[0,"desc"]]}),!0},window.Evercam||(window.Evercam={}),window.Evercam.Logs={initializeTab:e}}.call(this);